box: wercker-labs/docker
build:
  steps:
    - script:
        name: Build image
        code: docker build -t sub2home-desktop .
    - script:
        name: run tests
        code: docker run sub2home-desktop grunt test
    - script:
        name: export image
        code: |
            mkdir build
            docker save sub2home-desktop > build/image.tar
deploy:
  steps:
    - s3sync:
        key-id: $KEY
        key-secret: $SECRET
        bucket-url: $BUCKET/desktop/
        source-dir: ./build
        opts: --reduced-redundancy --acl-private
